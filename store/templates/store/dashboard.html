{% extends "store/base.html" %}
{% load static %}

{% block title %}Dashboard{% endblock title %}

{% block content %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>


<!-- Stat Cards -->
<div class="container-fluid">
  <div class="row g-4 mb-5">

    <div class="col-xl-3 col-sm-6">
      <a href="{% url 'productslist' %}">
        <div class="card shadow border-0">
          <div class="card-body d-flex justify-content-between align-items-center">
            <div>
              <p class="text-muted mb-1">Inventory Quantity</p>
              <h3 class="fw-bold">{{ total_items }}</h3>
            </div>
            <div class="icon icon-shape bg-secondary text-white rounded-circle p-3">
              <i class="fas fa-clipboard-list"></i>
            </div>
          </div>
        </div>
      </a>
    </div>

    <div class="col-xl-3 col-sm-6">
      <a href="{% url 'profile_list' %}">
        <div class="card shadow border-0">
          <div class="card-body d-flex justify-content-between align-items-center">
            <div>
              <p class="text-muted mb-1">Staff</p>
              <h3 class="fw-bold">{{ profiles_count }}</h3>
            </div>
            <div class="icon icon-shape bg-primary text-white rounded-circle p-3">
              <i class="fas fa-users"></i>
            </div>
          </div>
        </div>
      </a>
    </div>

    <div class="col-xl-3 col-sm-6">
      <a href="{% url 'customer_list' %}">
        <div class="card shadow border-0">
          <div class="card-body d-flex justify-content-between align-items-center">
            <div>
              <p class="text-muted mb-1">Customers</p>
              <h3 class="fw-bold">{{ customers_count }}</h3>
            </div>
            <div class="icon icon-shape bg-success text-white rounded-circle p-3">
              <i class="fas fa-user"></i>
            </div>
          </div>
        </div>
      </a>
    </div>

    <div class="col-xl-3 col-sm-6">
      <a href="{% url 'deliveries' %}">
        <div class="card shadow border-0">
          <div class="card-body d-flex justify-content-between align-items-center">
            <div>
              <p class="text-muted mb-1">Pending Deliveries</p>
              <h3 class="fw-bold">{{ delivery.count }}</h3>
            </div>
            <div class="icon icon-shape bg-info text-white rounded-circle p-3">
              <i class="fas fa-truck"></i>
            </div>
          </div>
        </div>
      </a>
    </div>

    <div class="col-xl-3 col-sm-6">
      <a href="{% url 'saleslist' %}">
        <div class="card shadow border-0">
          <div class="card-body d-flex justify-content-between align-items-center">
            <div>
              <p class="text-muted mb-1">Sales</p>
              <h3 class="fw-bold">{{ sales.count }}</h3>
            </div>
            <div class="icon icon-shape bg-warning text-white rounded-circle p-3">
              <i class="fas fa-shopping-cart"></i>
            </div>
          </div>
        </div>
      </a>
    </div>

  </div>

  <!-- Stock Summary + Chart -->
  <div class="card shadow border-0 mb-5">
    <div class="card-body text-center">
      <h5 class="text-primary fw-bold">Solv-IT Stock by Category</h5>
      <hr>
      <div class="row justify-content-center mt-4">
        <div class="col-md-3 col-sm-6 mb-3">
          <p>SSDs</p>
          <a href="/searchitem/?q=ssd" class="h5 text-decoration-underline">{{ stock_summary.ssd }}</a>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
          <p>Processors</p>
          <a href="/searchitem/?q=processor" class="h5 text-decoration-underline">{{ stock_summary.processor }}</a>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
          <p>HDDs</p>
          <a href="/searchitem/?q=hdd" class="h5 text-decoration-underline">{{ stock_summary.hdd }}</a>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
          <p>RAMs</p>
          <a href="/searchitem/?q=ram" class="h5 text-decoration-underline">{{ stock_summary.ram }}</a>
        </div>
      </div>
      <canvas id="stockChart" height="100"></canvas>
    </div>
  </div>
</div>
{% endblock content %}

{% block javascripts %}
<script>
  let stockChartInstance = null;

  function renderStockChart(theme = 'light') {
    const ctx = document.getElementById('stockChart').getContext('2d');
    if (stockChartInstance) {
      stockChartInstance.destroy();
    }
    stockChartInstance = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['SSD', 'Processor', 'HDD', 'RAM'],
        datasets: [{
          data: [{{ stock_summary.ssd }}, {{ stock_summary.processor }}, {{ stock_summary.hdd }}, {{ stock_summary.ram }}],
          backgroundColor: ['#0d6efd', '#28a745', '#ffc107', '#17a2b8']
        }]
      },
      options: {
        responsive: true,
        legend: {
          position: 'bottom',
          labels: {
            fontColor: theme === 'dark' ? '#e0e0e0' : '#000'
          }
        }
      }
    });
  }

  const toggle = document.getElementById('darkModeToggle');
  const body = document.body;

  if (localStorage.getItem('theme') === 'dark') {
    body.classList.add('dark-mode');
    toggle.checked = true;
    renderStockChart('dark');
  } else {
    renderStockChart('light');
  }

  toggle.addEventListener('change', function () {
    if (this.checked) {
      body.classList.add('dark-mode');
      localStorage.setItem('theme', 'dark');
      renderStockChart('dark');
    } else {
      body.classList.remove('dark-mode');
      localStorage.setItem('theme', 'light');
      renderStockChart('light');
    }
  });
</script>
{% endblock javascripts %}
